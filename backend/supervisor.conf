[unix_http_server]
file=/var/run/supervisor.sock   ; (path to supervisor.sock file, root can write here)
chmod=0700                       ; socket file mode (default 0700)

[supervisord]
logfile=/var/log/supervisor/supervisord.log ; (main log file; default $CWD/supervisord.log)
pidfile=/var/run/supervisord.pid ; (supervisord pidfile; root can write here)
childlogdir=/var/log/supervisor            ; ('AUTO' child log dir, default $TEMP)
nodaemon=true                   ; (start in foreground if true; default false)
minfds=1024                     ; (min. avail startup file descriptors; default 1024)
minprocs=200                    ; (min. avail process descriptors; default 200)
; user=appuser                  ; <<-- COMMENTED OUT/REMOVED: supervisord will run as root

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock ; use a unix:// URL for a unix socket
;prompt=mysupervisor         ; cmd line prompt (default "supervisor")

; --- Program Definitions ---

[program:calculation-engine]
command=/app/calculation_service
directory=/app
user=appuser                 ; <<-- IMPORTANT: This program runs as appuser
autostart=true
autorestart=true
stopwaitsecs=10
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisor/calc_engine_stdout.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/calc_engine_stderr.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5
environment=DEBUG="1",PORT="8081",MEGA_EMAIL="%(ENV_MEGA_EMAIL)s",MEGA_PWD="%(ENV_MEGA_PWD)s",MEGA_METRICS_FOLDER_PATH="%(ENV_MEGA_METRICS_FOLDER_PATH)s",LOG_LEVEL="debug"

[program:metrics-generator]
command=/app/metrics_generator
directory=/app
user=appuser                 ; <<-- IMPORTANT: This program runs as appuser
autostart=true
autorestart=true
stopwaitsecs=10
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisor/metrics_gen_stdout.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/var/log/supervisor/metrics_gen_stderr.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5
environment=MEGA_EMAIL="%(ENV_MEGA_EMAIL)s",MEGA_PWD="%(ENV_MEGA_PWD)s",MEGA_METRICS_FOLDER_PATH="%(ENV_MEGA_METRICS_FOLDER_PATH)s"